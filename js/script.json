document.addEventListener('DOMContentLoaded', function () {
    // Get references to buttons and forms
    const volunteerButton = document.getElementById('volunteerButton');
    const partnerButton = document.getElementById('partnerButton');
    const volunteerForm = document.getElementById('volunteer-form-section');
    const partnerForm = document.getElementById('partner-form-section');
    const volunteerEmailId = "mnnjkywe"
    const partnerEmailID = "mqaevore"

    // Get the forms
    const volunteer = document.getElementById("volunteer-form")
    const partner = document.getElementById("partner-form")

    // Create overlay element
    const overlay = document.createElement('div');
    overlay.classList.add('overlay');
    document.querySelector('.get-involved-page').appendChild(overlay);

    // Function to open a form
    function openForm(form) {
        form.style.display = 'block';
        overlay.classList.add('active');
    }

    // Function to close all forms and remove overlay
    function closeAllForms(form) {
        form.style.display = 'none';
        overlay.classList.remove('active');

        // Remove success message if present
        removeSuccessMessage(form);
    }

    // Function to remove success message if present
    function removeSuccessMessage(form) {
        const successMessage = form.parentNode.querySelector('.success-message');
        if (successMessage) {
            successMessage.remove();
        }
    }
    // Attach event listener to each form and set its default behaviour
    volunteer.addEventListener("submit", async (t) => {
        t.preventDefault()

        let validation = isValidEmail(volunteer)
        if (!validation){
            return;
        }
        const formData = new FormData(volunteer);
        try {
        const response = await fetch(`https://formspree.io/f/${volunteerEmailId}`, {
            method: "POST",
            body: formData,
            headers: {
                Accept: "application/json"
            }
            });
        if (response.ok) {
            const successMessage = document.createElement('div');
            successMessage.classList.add('success-message');
            successMessage.textContent = "Thank you for submitting the form!";
            volunteerForm.parentNode.appendChild(successMessage);

            volunteerForm.style.display = 'none';
             overlay.classList.remove('active');
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
                removeSuccessMessage(volunteerForm);
                }, 5000);
                volunteer.reset();
        } else {
             console.error(err);
        }
        } catch (err){
            console.error(err);
        }
    })

    partner.addEventListener("submit", async (t) => {
        t.preventDefault()

        let validation = isValidEmail(partner)
        if (!validation){
            return;
        }

        const formData = new FormData(partner);
        try {
        const response = await fetch(`https://formspree.io/f/${partnerEmailID}`, {
            method: "POST",
            body: formData,
            headers: {
                Accept: "application/json"
            }
            });
        if (response.ok) {
            const successMessage = document.createElement('div');
            successMessage.classList.add('success-message');
            successMessage.textContent = "Thank you for submiting the form!";
            partnerForm.parentNode.appendChild(successMessage);

            partnerForm.style.display = 'none';
            overlay.classList.remove('active');
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
                 removeSuccessMessage(partnerForm);
                }, 5000);
                partner.reset();

        } else {
             console.error(err);
        }
        } catch (err){
            console.error(err);
        }
    })
    // Function
    function isValidEmail(form) {
        form.querySelectorAll(".error-message").forEach(e => e.textContent = "");
            const n = form.querySelector('input[type="email"]');
            if (n && !validateEmail(n.value)) {
                const o = n.parentElement.querySelector(".error-message");
                o.textContent = "Please enter a valid email address.", n.focus()
                return false;
            }
            return true;
    }
  //------------------ Get involved page code -----------------
     // Add close button functionality
     document.querySelectorAll('.close-btn').forEach(button => {
        button.addEventListener('click', function(event) {
            const form = this.closest('section');
            closeAllForms(form); // close a specific form
        });
    });
    // Attach event listener to "Volunteer" button
    volunteerButton.addEventListener('click', function (event) {
        event.preventDefault();
        openForm(volunteerForm);
    });

    // Attach event listener to "Partner with Us" button
    partnerButton.addEventListener('click', function (event) {
        event.preventDefault();
        openForm(partnerForm);
    });

    // Close forms and remove overlay on overlay click
    overlay.addEventListener('click', function () {
        closeAllForms();
    });

//---------- Gallery Modal Functionality ----------

    function validateEmail(e) {
        const t = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return t.test(e)
    }
  // Gallery Modal Functionality
     const viewAllGalleryBtn = document.getElementById('view-all-gallery');
     const galleryModal = document.getElementById('gallery-modal');
     const closeGalleryBtn = document.getElementById('close-gallery');

     viewAllGalleryBtn.addEventListener('click', function() {
         galleryModal.style.display = 'block';
     });

     closeGalleryBtn.addEventListener('click', function() {
         galleryModal.style.display = 'none';
     });

     window.addEventListener('click', function(event) {
         if (event.target == galleryModal) {
             galleryModal.style.display = 'none';
         }
     });

     document.addEventListener("keydown", e => {
         "Escape" === e.key && galleryModal.style.display === "block" && (galleryModal.style.display = "none")
     });
     // ---------------------- End Gallery modal code --------------------
});